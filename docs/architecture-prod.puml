@startuml
title FFE â€“ Prod architecture (root_domain = fullfrontend.be)

skinparam backgroundColor #ffffff
skinparam componentStyle rectangle

actor User

rectangle "DigitalOcean DNS" as DODNS
database "DO Spaces\n(Velero backups)" as Spaces
database "DO Spaces\n(WP uploads via plugin)" as SpacesWP

package "Kubernetes (DOKS)\nnode pool autoscaling" {
  package "infra namespace" {
    component "Traefik\n(LoadBalancer ingress)" as Traefik
    component "cert-manager" as Cert
    component "external-dns" as ExtDNS
    component "Velero" as Velero
  }

  package "data namespace" {
    database "Postgres\n(postgres.data)" as Postgres
    database "MariaDB\n(mariadb.data)" as MariaDB
  }

  package "apps namespace" as Apps {
    component "WordPress\nhost: fullfrontend.be" as WP
    component "n8n\nhosts: n8n.fullfrontend.be\nwebhook.fullfrontend.be" as N8N
    component "Analytics (Vince)\nhost: insights.fullfrontend.be" as Vince
    component "Registry (Zot)\nhost: registry.fullfrontend.be" as Zot
    component "Nextcloud (planned)" as Nextcloud
    component "Mailu (planned)" as Mailu
  }
}

User --> DODNS
DODNS --> Traefik
Traefik --> Apps : ingress routes

Apps --> MariaDB : WordPress
Apps --> Postgres : n8n / Analytics / Registry / planned apps
Postgres ..> Velero : backups
MariaDB ..> Velero : backups

Apps ..> SpacesWP : WP uploads (plugin offload)

Apps --> ExtDNS : hosts auto-update
Apps --> Cert : certificates (prod)
ExtDNS ..> DODNS : auto-update
Cert ..> DODNS : auto-update

Velero --> Spaces

note right of Traefik
IngressController (LoadBalancer)
routes to apps namespace
end note

note bottom of Postgres
DB init via init job (admin secret)
end note

note bottom of MariaDB
DB init via init job (admin secret)
end note

legend left
Prod settings:
- root_domain_prod = fullfrontend.be
- Velero -> Spaces bucket
- external-dns -> DO DNS
- cert-manager enabled
- Registry exposed via ingress (Zot)
- WP uploads offloaded via plugin to DO Spaces
endlegend
@enduml
